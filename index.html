<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡πÅ‡∏≠‡∏õ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô Modern</title>
<meta name="theme-color" content="#4CAF50">
<style>
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  margin:0; padding:20px;
  display:flex; justify-content:center;
  background: linear-gradient(to bottom right, #f0f4f8, #d9e2ec);
}
.container {
  width:95%; max-width:720px; background:#fff; padding:25px 30px; border-radius:20px;
  box-shadow:0 10px 30px rgba(0,0,0,0.12); transition: all 0.3s ease;
}
h2 {text-align:center; color:#2c3e50; margin-top:0;}
.language-select {text-align:right; margin-bottom:15px;}
details {margin:15px 0; border-radius:12px; padding:12px; background:#f9fafc; box-shadow:0 2px 8px rgba(0,0,0,0.08);}
details summary {font-weight:600; font-size:16px; cursor:pointer; color:#34495e;}
.input-row {display:flex; flex-wrap:wrap; gap:12px; margin-top:10px;}
.input-row input, .input-row select {flex:1; padding:10px 12px; border:1px solid #ccd6dd; border-radius:10px; font-size:14px; transition:0.2s;}
.input-row input:focus, .input-row select:focus {border-color:#4CAF50; outline:none; box-shadow:0 0 6px rgba(76,175,80,0.3);}
button {padding:10px 18px; margin-top:12px; cursor:pointer; border:none; border-radius:12px; background:#4CAF50; color:white; font-weight:600; font-size:15px; transition:0.2s;}
button:hover {background:#45a049;}
#result {margin-top:20px; padding:20px; border-radius:16px; background:#e8f5e9; border:1px solid #a5d6a7; font-weight:500; line-height:1.6;}
#saveImageBtn {background:#ff9800; margin-left:10px; display:none;}
#saveImageBtn:hover { background:#fb8c00; }
#installPopup {display:none; position:fixed; bottom:20px; left:50%; transform:translateX(-50%); background:#fff; padding:15px 20px; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.3); z-index:3000; text-align:center;}
#installPopup button {padding:6px 12px; border:none; border-radius:8px; cursor:pointer; margin-top:8px;}
#installPopup .closeBtn { background:#ccc; margin-top:5px; }
</style>
</head>
<body>

<div class="container" id="appContent">
  <div class="language-select">
    <select id="langSelect">
      <option value="th">‡πÑ‡∏ó‡∏¢</option>
      <option value="en">English</option>
    </select>
  </div>

  <h2 id="title">üìä ‡πÅ‡∏≠‡∏õ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô Modern</h2>

  <details open>
    <summary id="labelLabor">üíº ‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á & ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</summary>
    <div class="input-row">
      <input type="number" id="workers" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô">
      <input type="number" id="wage" placeholder="‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á‡∏ï‡πà‡∏≠‡∏Ñ‡∏ô">
    </div>
    <div class="input-row">
      <input type="number" id="water" placeholder="‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥">
      <input type="number" id="electricity" placeholder="‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü">
    </div>
  </details>

  <details>
    <summary id="labelMaterial">ü•¶ ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</summary>
    <div id="materials"></div>
    <button onclick="addMaterial()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</button>
  </details>

  <details>
    <summary id="labelProfit">üí∞ ‡∏Å‡∏≥‡πÑ‡∏£</summary>
    <div class="input-row">
      <input type="number" id="profit" placeholder="‡∏Å‡∏≥‡πÑ‡∏£ %">
      <select id="profitType">
        <option value="day">‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</option>
        <option value="month" selected>‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</option>
        <option value="year">‡∏£‡∏≤‡∏¢‡∏õ‡∏µ</option>
      </select>
      <input type="number" id="duration" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (‡∏ß‡∏±‡∏ô/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏õ‡∏µ)">
    </div>
  </details>

  <button onclick="calculate()" id="calcBtn">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</button>
  <button id="saveImageBtn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏†‡∏≤‡∏û</button>
  <div id="result"></div>
</div>

<div id="installPopup">
  <p id="installText">üì≤ ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÇ‡∏Æ‡∏° ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏™‡∏∞‡∏î‡∏ß‡∏Å‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÅ‡∏≠‡∏õ‡∏à‡∏£‡∏¥‡∏á</p>
  <button id="installBtn">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÇ‡∏Æ‡∏°</button>
  <button class="closeBtn" onclick="document.getElementById('installPopup').style.display='none'">‡∏õ‡∏¥‡∏î</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
let materialCount = 0;
const texts = {
  th: {
    title:"üìä ‡πÅ‡∏≠‡∏õ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô Modern",
    labelLabor:"üíº ‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á & ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢",
    labelMaterial:"ü•¶ ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö",
    labelProfit:"üí∞ ‡∏Å‡∏≥‡πÑ‡∏£",
    workers:"‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô",
    wage:"‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á‡∏ï‡πà‡∏≠‡∏Ñ‡∏ô",
    water:"‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥",
    electricity:"‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü",
    profit:"‡∏Å‡∏≥‡πÑ‡∏£ %",
    duration:"‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (‡∏ß‡∏±‡∏ô/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏õ‡∏µ)",
    calcBtn:"‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì",
    save:"‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏†‡∏≤‡∏û",
    install:"üì≤ ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÇ‡∏Æ‡∏° ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏™‡∏∞‡∏î‡∏ß‡∏Å‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÅ‡∏≠‡∏õ‡∏à‡∏£‡∏¥‡∏á"
  },
  en: {
    title:"üìä Cost Calculator Modern",
    labelLabor:"üíº Labor & Expenses",
    labelMaterial:"ü•¶ Materials",
    labelProfit:"üí∞ Profit",
    workers:"Workers",
    wage:"Wage per person",
    water:"Water cost",
    electricity:"Electricity cost",
    profit:"Profit %",
    duration:"Duration (day/month/year)",
    calcBtn:"Calculate",
    save:"Save Image",
    install:"üì≤ Install this app to Home Screen for quick access"
  }
};

// ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏†‡∏≤‡∏©‡∏≤
document.getElementById("langSelect").addEventListener("change", e=>{
  const lang=e.target.value;
  document.getElementById("title").textContent=texts[lang].title;
  document.getElementById("labelLabor").textContent=texts[lang].labelLabor;
  document.getElementById("labelMaterial").textContent=texts[lang].labelMaterial;
  document.getElementById("labelProfit").textContent=texts[lang].labelProfit;
  document.getElementById("workers").placeholder=texts[lang].workers;
  document.getElementById("wage").placeholder=texts[lang].wage;
  document.getElementById("water").placeholder=texts[lang].water;
  document.getElementById("electricity").placeholder=texts[lang].electricity;
  document.getElementById("profit").placeholder=texts[lang].profit;
  document.getElementById("duration").placeholder=texts[lang].duration;
  document.getElementById("calcBtn").textContent=texts[lang].calcBtn;
  document.getElementById("saveImageBtn").textContent=texts[lang].save;
  document.getElementById("installText").textContent=texts[lang].install;
});

// --- ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì / ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏†‡∏≤‡∏û ---
function addMaterial(name="", cost=""){
  materialCount++;
  const div = document.createElement("div");
  div.className = "input-row";
  div.id = "material-" + materialCount;
  div.innerHTML = `
    <input type="text" placeholder="Material name" value="${name}">
    <input type="text" placeholder="Cost (unit)" value="${cost}">
    <button onclick="editMaterial(${materialCount})">‚öôÔ∏è</button>
    <button onclick="deleteMaterial(${materialCount})">‚ùå</button>
  `;
  document.getElementById("materials").appendChild(div);
}
function deleteMaterial(id){document.getElementById("material-"+id).remove();}
function editMaterial(id){
  const div=document.getElementById("material-"+id);
  const inputs=div.getElementsByTagName("input");
  inputs[0].disabled=!inputs[0].disabled;
  inputs[1].disabled=!inputs[1].disabled;
}
function calculate(){
  const workers = parseFloat(document.getElementById("workers").value)||0;
  const wage = parseFloat(document.getElementById("wage").value)||0;
  const water = parseFloat(document.getElementById("water").value)||0;
  const electricity = parseFloat(document.getElementById("electricity").value)||0;
  const profit = parseFloat(document.getElementById("profit").value)||0;
  const profitType = document.getElementById("profitType").value;
  const duration = parseFloat(document.getElementById("duration").value)||1;

  let materialCost=0;
  document.querySelectorAll("#materials .input-row").forEach(row=>{
    const cost=parseFloat(row.children[1].value)||0;
    materialCost+=cost;
  });

  const laborCost=workers*wage;
  const otherCost=water+electricity;
  const totalCost=laborCost+otherCost+materialCost;

  let profitTotal=totalCost*(profit/100)*duration;

  const lang=document.getElementById("langSelect").value;
  const txt=(lang==="th")?{
    labor:"üíº ‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á‡∏£‡∏ß‡∏°",other:"üíß ‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥ + ‚ö° ‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü",material:"ü•¶ ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö",total:"üìä ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°",profitText:`üí∞ ‡∏Å‡∏≥‡πÑ‡∏£ (${profit}% / ${profitType})`
  }:{
    labor:"üíº Labor cost",other:"üíß Water + ‚ö° Electricity",material:"ü•¶ Materials",total:"üìä Total cost",profitText:`üí∞ Profit (${profit}% / ${profitType})`
  };

  document.getElementById("result").innerHTML=`
    ${txt.labor}: ${laborCost}<br>
    ${txt.other}: ${otherCost}<br>
    ${txt.material}: ${materialCost}<br>
    ${txt.total}: ${totalCost}<br>
    ${txt.profitText}: ${profitTotal}
  `;
  document.getElementById("saveImageBtn").style.display="inline-block";
}

// save screenshot
document.getElementById("saveImageBtn").addEventListener("click", ()=>{
  html2canvas(document.getElementById("appContent")).then(canvas=>{
    const link=document.createElement("a");
    link.download="calculation.png";
    link.href=canvas.toDataURL();
    link.click();
  });
});

// Add to Home
let deferredPrompt;
window.addEventListener("beforeinstallprompt",(e)=>{
  e.preventDefault(); deferredPrompt=e;
  document.getElementById("installPopup").style.display="block";
});
document.getElementById("installBtn").addEventListener("click", async ()=>{
  document.getElementById("installPopup").style.display="none";
  if(deferredPrompt){deferredPrompt.prompt(); deferredPrompt.userChoice.then(()=>{deferredPrompt=null;});}
});

// Service Worker inline
if("serviceWorker" in navigator){
  const swCode=`self.addEventListener("install",e=>{self.skipWaiting();});
  self.addEventListener("activate",e=>{clients.claim();});
  self.addEventListener("fetch",e=>{});`;
  const blob=new Blob([swCode],{type:"application/javascript"});
  navigator.serviceWorker.register(URL.createObjectURL(blob)).then(reg=>{
    console.log("SW registered");
    reg.onupdatefound=()=>{const newWorker=reg.installing;
      newWorker.onstatechange=()=>{if(newWorker.state==="installed"&&navigator.serviceWorker.controller){
        console.log("üîÑ update detected, reload"); window.location.reload();}};};
  });
}
</script>
</body>
</html>
